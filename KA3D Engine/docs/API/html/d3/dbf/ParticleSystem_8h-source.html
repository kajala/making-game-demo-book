<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Engine Core: ParticleSystem.h Source File</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8-20040824 -->
<div class="qindex"><a class="qindex" href="../../index.html">Main&nbsp;Page</a> | <a class="qindex" href="../../modules.html">Modules</a> | <a class="qindex" href="../../hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="../../classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="../../annotated.html">Class&nbsp;List</a> | <a class="qindex" href="../../files.html">File&nbsp;List</a> | <a class="qindex" href="../../functions.html">Class&nbsp;Members</a></div>
<h1>ParticleSystem.h</h1><div class="fragment"><pre class="fragment">00001 <span class="preprocessor">#ifndef _HGR_PARTICLESYSTEM_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _HGR_PARTICLESYSTEM_H</span>
00003 <span class="preprocessor"></span>
00004 
00005 <span class="preprocessor">#include &lt;gr/Primitive.h&gt;</span>
00006 <span class="preprocessor">#include &lt;hgr/Visual.h&gt;</span>
00007 <span class="preprocessor">#include &lt;math/Domain.h&gt;</span>
00008 <span class="preprocessor">#include &lt;lang/Array.h&gt;</span>
00009 
00010 
00011 <span class="keyword">namespace </span>gr {
00012     <span class="keyword">class </span>Shader;
00013     <span class="keyword">class </span>Texture;}
00014 
00015 <span class="keyword">namespace </span>lua {
00016     <span class="keyword">class </span>LuaTable;}
00017 
00018 
00019 <span class="keyword">namespace </span>hgr
00020 {
00021 
00022 
00023 <span class="keyword">class </span>ResourceManager;
00024 
00025 
<a name="l00070"></a><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html">00070</a> <span class="keyword">class </span><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html">ParticleSystem</a> :
00071     <span class="keyword">public</span> hgr::<a class="code" href="../../d3/d89/classhgr_1_1Visual.html">Visual</a>
00072 {
00073 <span class="keyword">public</span>:
<a name="l00077"></a><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w9">00077</a>     <span class="keyword">enum</span> <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w9">KillType</a>
00078     {
00080         KILL_NONE,
00082         KILL_OLDEST,
00084         KILL_RANDOM,
00086         <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w9w5">KILL_COUNT</a>
00087     };
00088 
<a name="l00093"></a><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w13">00093</a>     <span class="keyword">enum</span> <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w13">ViewType</a>
00094     {
00098         VIEW_CAMERAUP,
00102         VIEW_WORLDUP,
00106         <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w13w11">VIEW_COUNT</a>
00107     };
00108 
<a name="l00113"></a><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w4">00113</a>     <span class="keyword">enum</span> <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w4">AnimationType</a>
00114     {
00119         ANIM_LOOP,
00124         ANIM_LIFE,
00129         ANIM_RANDOM,
00133         <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#w4w0">ANIM_COUNT</a>
00134     };
00135 
<a name="l00143"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html">00143</a>     <span class="keyword">class </span><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html">Description</a> :
00144         <span class="keyword">public</span> lang::Object
00145     {
00146     <span class="keyword">public</span>:
00147         <span class="keyword">enum</span>
00148         {
00150             <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#w0w1">MAX_PARTICLES_LIMIT</a> = 65535/6 
00151         };
00152 
<a name="l00154"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o23">00154</a>         <span class="keywordtype">int</span>                 systemMaxEmissions;
00155 
<a name="l00157"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o24">00157</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        systemRate;
00158 
<a name="l00160"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o25">00160</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        systemStopTime;
00161 
<a name="l00163"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o21">00163</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        systemLifeTime;
00164 
<a name="l00166"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o2">00166</a>         <span class="keywordtype">int</span>                 emissionMaxParticles;
00167 
<a name="l00169"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o4">00169</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        emissionRate;
00170 
<a name="l00172"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o5">00172</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        emissionStopTime;
00173 
<a name="l00175"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o0">00175</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        emissionLifeTime;
00176 
<a name="l00178"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o3">00178</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        emissionPosition;
00179 
<a name="l00181"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o10">00181</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleLifeTime;
00182         
<a name="l00184"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o19">00184</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleStartVelocity;
00185         
<a name="l00187"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o17">00187</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleStartPosition;
00188         
<a name="l00190"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o18">00190</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleStartSize;
00191         
<a name="l00193"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o9">00193</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleEndSize;
00194         
<a name="l00196"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o15">00196</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleStartAlpha;
00197         
<a name="l00199"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o7">00199</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleEndAlpha;
00200         
<a name="l00202"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o16">00202</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleStartColor;
00203         
<a name="l00205"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o8">00205</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleEndColor;
00206         
<a name="l00211"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o11">00211</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleSpriteElasticity;
00212         
<a name="l00214"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o13">00214</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleSpriteRotation;
00215         
<a name="l00217"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o14">00217</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleSpriteStartRotationSpeed;
00218         
<a name="l00220"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o12">00220</a>         <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>        particleSpriteEndRotationSpeed;
00221         
<a name="l00223"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o6">00223</a>         <span class="keywordtype">float</span>               gravity;
00224         
<a name="l00226"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o30">00226</a>         <a class="code" href="../../d5/d00/classmath_1_1float3.html">math::float3</a>        wind;
00227         
<a name="l00229"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o27">00229</a>         <span class="keywordtype">float</span>               textureFrameRate;
00230                 
<a name="l00232"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o28">00232</a>         <span class="keywordtype">int</span>                 textureFrames;
00233         
00235         <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#a2">P</a>(<a class="code" href="../../d3/d75/classgr_1_1Texture.html">gr::Texture</a>)      texture;
00236         
00238         P(gr::Shader)       shader;
00239         
<a name="l00241"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o26">00241</a>         AnimationType       textureAnimation;
00242         
<a name="l00244"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o29">00244</a>         ViewType            textureView;
00245         
<a name="l00247"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o1">00247</a>         KillType            emissionLimitKill;
00248 
<a name="l00250"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o22">00250</a>         KillType            systemLimitKill;
00251 
<a name="l00253"></a><a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#o20">00253</a>         <span class="keywordtype">bool</span>                particleUpdateAlways;
00254 
00255         <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html">Description</a>();
00256 
00257     private:
00258         friend class <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html">ParticleSystem</a>;
00259 
00260         <span class="comment">// intermediate values cached from the description</span>
00261         <span class="keywordtype">float</span>               textureFrameUV;
00262         lang::Array&lt;<span class="keywordtype">float</span>&gt;  uvcache;
00263     };
00264 
00276     ParticleSystem( gr::Context* context, const lang::String&amp; filename, <a class="code" href="../../df/dec/classhgr_1_1ResourceManager.html">ResourceManager</a>* res=0,
00277         const lang::String&amp; texturepath="", const lang::String&amp; shaderpath="" );
00278 
00282     explicit ParticleSystem( <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html">Description</a>* desc );
00283 
00287     explicit ParticleSystem( const ParticleSystem&amp; other );
00288 
00289     ~ParticleSystem();
00290 
00297     <span class="keywordtype">void</span>    load( gr::Context* context, const lang::String&amp; filename, <a class="code" href="../../df/dec/classhgr_1_1ResourceManager.html">ResourceManager</a>* res,
00298                 const lang::String&amp; texturepath="", const lang::String&amp; shaderpath="" );
00299 
00304     <span class="keywordtype">void</span>    update( <span class="keywordtype">float</span> dt );
00305 
00312     <span class="keywordtype">void</span>    render( gr::Context* context, <a class="code" href="../../d9/db3/classhgr_1_1Camera.html">Camera</a>* camera, <span class="keywordtype">int</span> priority );
00313 
00320     <span class="keywordtype">void</span>    getShaders( lang::Array&lt;gr::Shader*&gt;&amp; shaders );
00321 
00325     <span class="keywordtype">void</span>    setTechnique( const <span class="keywordtype">char</span>* name );
00326 
00330     <span class="keywordtype">void</span>    reset();
00331 
00335     <span class="keywordtype">void</span>    computeBound();
00336 
00342     <span class="keywordtype">void</span>    setDelay( <span class="keywordtype">float</span> time );
00343 
00348     <span class="keywordtype">void</span>    setParentVelocity( const math::float3&amp; vel );
00349 
<a name="l00353"></a><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#a2">00353</a>     <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html">Description</a>*    description()                   {<span class="keywordflow">return</span> m_desc;}
00354 
00358     <span class="keywordtype">int</span>             <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#a5">particles</a>() const;
00359 
<a name="l00363"></a><a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#a1">00363</a>     const <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html">Description</a>*      description()<span class="keyword"> const     </span>{<span class="keywordflow">return</span> m_desc;}
00364 
00369     <span class="keyword">static</span> ViewType         <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#e2">toViewType</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* sz );
00370 
00375     <span class="keyword">static</span> AnimationType    <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#e0">toAnimationType</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* sz );
00376 
00381     <span class="keyword">static</span> KillType         <a class="code" href="../../d8/d7f/classhgr_1_1ParticleSystem.html#e1">toKillType</a>( <span class="keyword">const</span> <span class="keywordtype">char</span>* sz );
00382 
00383 <span class="keyword">private</span>:
00384     <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt; <span class="keyword">class </span>Integral
00385     {
00386     <span class="keyword">public</span>:
00387         T       v;
00388         T       dv;
00389 
00390         <span class="keywordtype">void</span> set( <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>&amp; startdomain, <a class="code" href="../../d5/de0/classmath_1_1Domain.html">math::Domain</a>&amp; enddomain, <span class="keywordtype">float</span> invlife )
00391         {
00392             startdomain.<a class="code" href="../../d5/de0/classmath_1_1Domain.html#a2">getRandom</a>( &amp;v );
00393             enddomain.<a class="code" href="../../d5/de0/classmath_1_1Domain.html#a2">getRandom</a>( &amp;dv );
00394             dv -= v;
00395             dv *= invlife;
00396         }
00397 
00398         <span class="keywordtype">void</span> integrate( <span class="keywordtype">float</span> dt )
00399         {
00400             v += dv*dt;
00401         }
00402     };
00403 
00404     <span class="keyword">class </span>Particle
00405     {
00406     <span class="keyword">public</span>:
00407         <span class="keywordtype">float</span>                                   time;
00408         <span class="keywordtype">float</span>                                   life;
00409         <span class="keywordtype">float</span>                                   rot;
00410         <span class="keywordtype">float</span>                                   elasticity;
00411         ParticleSystem::Integral&lt;float&gt;         size;
00412         ParticleSystem::Integral&lt;math::float3&gt;  color;
00413         ParticleSystem::Integral&lt;float&gt;         alpha;
00414         ParticleSystem::Integral&lt;float&gt;         rotspeed;
00415         <span class="keywordtype">int</span>                                     frame;
00416         <a class="code" href="../../d5/d00/classmath_1_1float3.html">math::float3</a>                            velocity;
00417         <a class="code" href="../../d5/d00/classmath_1_1float3.html">math::float3</a>                            position;
00418     };
00419 
00420     <span class="keyword">class </span>Emission
00421     {
00422     <span class="keyword">public</span>:
00423         <span class="keywordtype">float</span>                   time;
00424         <span class="keywordtype">float</span>                   stop;
00425         <span class="keywordtype">float</span>                   life;
00426         <span class="keywordtype">float</span>                   newParticles;
00427         <a class="code" href="../../d5/d00/classmath_1_1float3.html">math::float3</a>            position;
00428         <a class="code" href="../../d1/d9c/classlang_1_1Array.html">lang::Array&lt;Particle&gt;</a>   particles;
00429     };
00430 
00431     <a class="code" href="../../d2/dd1/classhgr_1_1ParticleSystem_1_1Description.html#a2">P</a>(Description)              m_desc;
00432     lang::Array&lt;Emission&gt;       m_emissions;
00433     <span class="keywordtype">float</span>                       m_time;
00434     <span class="keywordtype">float</span>                       m_timeSinceRender;
00435     <span class="keywordtype">float</span>                       m_newEmissions;
00436     <span class="keywordtype">float</span>                       m_systemStopTime;
00437     <span class="keywordtype">float</span>                       m_systemLifeTime;
00438     <span class="keywordtype">float</span>                       m_delay;
00439     math::float3                m_parentVelocity;
00440     P(gr::Primitive)            m_prim;
00441 
00442     <span class="keywordtype">void</span>        restart();
00443     <span class="keywordtype">void</span>        refreshCachedValues();
00444     static <span class="keywordtype">void</span> getDomain( const lang::String&amp; particlename, lua::LuaTable&amp; tab, const lang::String&amp; domainname, math::Domain* domain );
00445     static <span class="keywordtype">int</span>  log2i( <span class="keywordtype">int</span> x );
00446 
00447     template &lt;class T&gt; static <span class="keywordtype">void</span>  killOld( lang::Array&lt;T&gt;&amp; array );
00448     template &lt;class T&gt; static T*    getNew( lang::Array&lt;T&gt;&amp; array, <span class="keywordtype">int</span> limit, KillType killtype );
00449 
00450     ParticleSystem&amp; operator=( const ParticleSystem&amp; );
00451 };
00452 
00453 
00454 } <span class="comment">// hgr</span>
00455 
00456 
00457 #endif <span class="comment">// _HGR_PARTICLESYSTEM_H</span>
00458 
00459 <span class="comment">// Copyright (C) 2005 Jani Kajala. All rights reserved. Consult your license regarding permissions and restrictions.</span>
</pre></div><br><br><small>Copyright (C) 2004 Jani Kajala. All rights reserved. Consult your license regarding permissions and restrictions.</small><br><br></body></html>
